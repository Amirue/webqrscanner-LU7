<html>
<head>
<title>QRCODE</title>
<style type="text/css">
  #result {
    margin-top: 20px;
    font-size: 18px;
    color: blue;
  }
</style>

<script type="text/javascript" src="grid.js"></script>
<script type="text/javascript" src="version.js"></script>
<script type="text/javascript" src="detector.js"></script>
<script type="text/javascript" src="formatinf.js"></script>
<script type="text/javascript" src="errorlevel.js"></script>
<script type="text/javascript" src="bitmat.js"></script>
<script type="text/javascript" src="datablock.js"></script>
<script type="text/javascript" src="bmparser.js"></script>
<script type="text/javascript" src="datamask.js"></script>
<script type="text/javascript" src="rsdecoder.js"></script>
<script type="text/javascript" src="gf256poly.js"></script>
<script type="text/javascript" src="gf256.js"></script>
<script type="text/javascript" src="decoder.js"></script>
<script type="text/javascript" src="qrcode.js"></script>
<script type="text/javascript" src="findpat.js"></script>
<script type="text/javascript" src="alignpat.js"></script>
<script type="text/javascript" src="databr.js"></script>

<script type="text/javascript">
var video = null;
var canvas = null;
var gCtx = null;
var imageData = null;
var c = 0;

function load() {
    video = document.createElement("video");
    canvas = document.getElementById("qr-canvas");
    gCtx = canvas.getContext("2d");
    initCanvas(640, 480);
    qrcode.callback = read;
    
    navigator.mediaDevices.getUserMedia({ video: true })
    .then(function(stream) {
        video.srcObject = stream;
        video.play();
        requestAnimationFrame(tick);
    }).catch(function(err) {
        console.error("Error accessing webcam: ", err);
    });
}

function tick() {
    if (video.readyState === video.HAVE_ENOUGH_DATA) {
        gCtx.drawImage(video, 0, 0, canvas.width, canvas.height);
        try {
            qrcode.decode();
        } catch (e) {
            console.log("QR code not found.");
        }
    }
    requestAnimationFrame(tick);
}

function initCanvas(ww, hh) {
    canvas.width = ww;
    canvas.height = hh;
}

function read(a) {
  // Check if the result is a URL
  if (a.indexOf("http://") === 0 || a.indexOf("https://") === 0) {
    // Open the URL in a new tab
    window.open(a, "_blank");
  } else {
    // If it's not a URL, just display the result in the result div
    var resultDiv = document.getElementById('result');
    resultDiv.innerText = a; // Display the result as text
  }
}

</script>
</head>

<body onload="load()">
    <div class="container">
        <video id="video" width="640" height="480" style="display:none;"></video>
        <canvas id="qr-canvas" width="640" height="480"></canvas>
    </div>
    <div id="result">Scanned QR code result will appear here.</div>
</body>
</html>
